关于 Qwen 安装后的授权（`/auth`）问题，分析如下：

**可以自动化。**
既然授权是通过在聊天输入框发送 `/auth` 触发的，我们可以通过程序模拟这一动作，即在 Agent 启动并连接成功后，自动向其发送一条 `/auth` 消息，从而触发授权流程（例如返回登录链接）。这比让用户手动输入体验更好。

我将更新计划，在安装流程中加入**自动初始化/授权**的步骤。

### 1. 后端更新 (Main Process)

* **`src/main/index.ts`**:

  * **`agent:install`**: 保持原计划（npm 本地安装）。

  * **`agent:check-installed`**: 保持原计划。

  * **`agent:connect`**: 保持原计划（支持 env 和 path 替换）。

### 2. 前端更新 (Renderer Process)

* **`src/render/App.tsx`**:

  * **自动发送机制**：

    * 修改 `handleConnect` 或新增逻辑：当连接成功且检测到是“首次安装后运行”或用户明确点击了“修复/授权”时，自动调用 `agent:send("/auth")`。

  * **系统提示**：

    * 在自动发送 `/auth` 后，在聊天界面显示系统消息：“正在自动请求授权...”

* **`src/render/SettingsModal.tsx`**:

  * **安装后动作**：

    * 当 Qwen 安装完成后，将按钮状态变为“连接并认证 (Connect & Auth)”。

    * 点击该按钮将：

      1. 关闭设置弹窗。
      2. 触发主界面的连接流程。
      3. **附带指令**：告诉主界面连接后立即发送 `/auth`。

### 3. 验证计划

* **完整流程测试**：

  1. 在设置中选择 Qwen Agent（模拟未安装状态）。
  2. 点击“安装”（触发 npm install）。
  3. 安装完成后，点击“连接并认证”。
  4. 验证：

     * Agent 成功启动。

     * 聊天界面自动出现一条 User 发送的 `/auth` 消息（或直接显示系统反馈）。

     * Agent 返回授权相关的响应（如登录链接）。

